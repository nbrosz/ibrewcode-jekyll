---
layout: default
---

{% comment %}
=======================
The following part extracts all the tags from your posts and sort tags, so that you do not need to manually collect your tags to a place.
=======================
{% endcomment %}
{% assign rawtags = "" %}
{% assign rawcats = "" %}
{% for post in site.posts %}
	{% assign ttags = post.tags | join:'|' | append:'|' %}
    {% assign rawtags = rawtags | append:ttags %}
    {% assign tcats = post.categories | join:'|' | append:'|' %}
	{% assign rawcats = rawcats | append:tcats %}
{% endfor %}
{% assign rawtags = rawtags | split:'|' | sort %}
{% assign rawcats = rawcats | split:'|' | sort %}

{% comment %}
=======================
The following part removes duplicated tags and invalid tags like blank tag.
=======================
{% endcomment %}
{% assign tags = "" %}
{% for tag in rawtags %}
	{% if tag != "" %}
		{% if tags == "" %}
			{% assign tags = tag | split:'|' %}
		{% endif %}
		{% unless tags contains tag %}
			{% assign tags = tags | join:'|' | append:'|' | append:tag | split:'|' %}
		{% endunless %}
	{% endif %}
{% endfor %}

{% assign categories = "" %}
{% for cat in rawcats %}
	{% if cat != "" %}
		{% if categories == "" %}
			{% assign cat = cat | split:'|' %}
		{% endif %}
		{% unless categories contains cat %}
			{% assign categories = categories | join:'|' | append:'|' | append:cat | split:'|' %}
		{% endunless %}
	{% endif %}
{% endfor %}

<div id="taxonomies">
{% assign localAnchor = true %}
{% include taxonomies.html %}
</div>

{% assign posts = site.posts %}
{% assign postStyle = "display: none;" %}
{% include posts.html %}

<script>
    window.addEventListener('load', function (){
        var taxonomies = document.getElementById("taxonomies");

        parseTaxonomies(taxonomies);
        parsePosts();
        var taxonomyRegexp = /[#_](tag|cat|search)-([^\s#_]+)/g;

        var searchTerm = null;
        var match;
        while (match = taxonomyRegexp.exec(window.location.hash)) {
            if (match[1] == "tag")
                toggleTaxonomy(match[2], null);
            else if (match[1] == "cat")
                toggleTaxonomy(null, match[2]);
            else if (match[1] == "search" && !searchTerm)
                searchTerm = match[2];
        }

        performFilter(visibleTags, visibleCats, searchTerm);

        //if (searchTerm)
            //performSearch(searchTerm);
    });

    var tagTable = {}, catTable = {}, postList = [], taxonomyList = [], visibleTags = [], visibleCats = [];

    // parse tags/categories for full taxonomies list at top of page
    function parseTaxonomies(baseElem, post) {
        var generateClickFunction = function (tagParam, catParam) { // wrap in a function to circumvent hoisting
            return function () {
                toggleTaxonomy(tagParam, catParam);
                performFilter(visibleTags, visibleCats);
            };
        };

        var tagElems = baseElem.getElementsByClassName("tag");
        for (var j = 0; j < tagElems.length; j++) {
            var tagElem = tagElems[j];
            tagElem.href = "javascript:void(0);"; // disable href

            if (tagElem) {
                taxonomyList.push(tagElem);
                var tagClass = tagElem.getAttribute("data-slug");
                tagElem.onclick = generateClickFunction(tagClass, null);

                var tagPosts = tagTable[tagClass] = (tagTable[tagClass] || []);
                tagPosts.push({ post: post, elem: tagElem });
            }
        }
        var catElems = baseElem.getElementsByClassName("category");
        for (var j = 0; j < catElems.length; j++) {
            var catElem = catElems[j];
            catElem.href = "javascript:void(0);"; // disable href

            if (catElem) {
                taxonomyList.push(catElem);
                var catClass = catElem.getAttribute("data-slug");
                catElem.onclick = generateClickFunction(null, catClass);

                var catPosts = catTable[catClass] = (catTable[catClass] || []);
                catPosts.push({ post: post, elem: catElem });
            }
        }
    }

    // parse posts and their taxonomies
    function parsePosts() {
        postList = document.getElementsByClassName("post");
        for (var i = 0; i < postList.length; i++) {
            var post = postList[i];
            parseTaxonomies(post, post);
        }
    }

    function hideAllPosts() {
        for (var i = 0; i < postList.length; i++) {
            postList[i].classList.add("hidden");
            postList[i].classList.remove("visible");
            postList[i].removeAttribute("style"); // remove any initial styling
        }
        for (var i = 0; i < taxonomyList.length; i++) {
            taxonomyList[i].classList.add("disabled");
        }
    }

    function toggleTaxonomy(tag, category) {
        if (tag) {
            var tagIndex = visibleTags.indexOf(tag);
            if (tagIndex == -1)
                visibleTags.push(tag);
            else
                visibleTags.splice(tagIndex, 1);
        } else if (category) {
            var catIndex = visibleCats.indexOf(category);
            if (catIndex == -1)
                visibleCats.push(category);
            else
                visibleCats.splice(catIndex, 1);
        }
    }

    function updateHash(tags, cats, search)
    {
        var tagString = tags && tags.length ? "_tag-" + tags.join("_tag-") : "";
        var catString = cats && cats.length ? "_cat-" + cats.join("_cat-") : "";
        var searchString = search ? "_search-" + search : "";

        var hashString = tagString + catString + searchString;
        window.location.hash = "#" + hashString.substr(1, hashString.length);
    }

    function performFilter(tags, categories, search) {
        hideAllPosts();
        updateHash(tags, categories, search);
        if (tags && tagTable) {
            for (var i = 0; i < tags.length; i++) {
                var tagData = tagTable[tags[i]];
                if (tagData) {
                    for (var j = 0; j < tagData.length; j++) {
                        var data = tagData[j];
                        data.elem.classList.remove("disabled");
                        if (data.post) {
                            data.post.classList.remove("hidden");
                            data.post.classList.add("visible");
                        }
                    }
                }
            }
        }
        if (categories && catTable) {
            for (var i = 0; i < categories.length; i++) {
                var catData = catTable[categories[i]];
                if (catData) {
                    for (var j = 0; j < catData.length; j++) {
                        var data = catData[j];
                        data.elem.classList.remove("disabled");
                        if (data.post) {
                            data.post.classList.remove("hidden");
                            data.post.classList.add("visible");
                        }
                    }
                }
            }
        }
    }

</script>