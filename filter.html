---
layout: default
---

{% comment %}
=======================
The following part extracts all the tags from your posts and sort tags, so that you do not need to manually collect your tags to a place.
=======================
{% endcomment %}
{% assign rawtags = "" %}
{% assign rawcats = "" %}
{% for post in site.posts %}
	{% assign ttags = post.tags | join:'|' | append:'|' %}
    {% assign rawtags = rawtags | append:ttags %}
    {% assign tcats = post.categories | join:'|' | append:'|' %}
	{% assign rawcats = rawcats | append:tcats %}
{% endfor %}
{% assign rawtags = rawtags | split:'|' | sort %}
{% assign rawcats = rawcats | split:'|' | sort %}

{% comment %}
=======================
The following part removes dulpicated tags and invalid tags like blank tag.
=======================
{% endcomment %}
{% assign tags = "" %}
{% for tag in rawtags %}
	{% if tag != "" %}
		{% if tags == "" %}
			{% assign tags = tag | split:'|' %}
		{% endif %}
		{% unless tags contains tag %}
			{% assign tags = tags | join:'|' | append:'|' | append:tag | split:'|' %}
		{% endunless %}
	{% endif %}
{% endfor %}

{% assign categories = "" %}
{% for cat in rawcats %}
	{% if cat != "" %}
		{% if categories == "" %}
			{% assign cat = cat | split:'|' %}
		{% endif %}
		{% unless categories contains cat %}
			{% assign categories = categories | join:'|' | append:'|' | append:cat | split:'|' %}
		{% endunless %}
	{% endif %}
{% endfor %}

<div id="taxonomies">
{% assign localAnchor = true %}
{% include taxonomies.html %}
</div>

{% assign posts = site.posts %}
{% assign postStyle = "display: none;" %}
{% include posts.html %}

<script>
    window.onload = function() {
        parseTaxonomies();
        parsePosts();
        var taxonomyRegexp = /#tag-(\S+)|#cat-(\S+)/;
        var match = taxonomyRegexp.exec(window.location.hash);
        if (match) {
            var tag = match[1];
            var cat = match[2];
            toggleTaxonomy(tag, cat);
        }
    };

    var tagTable = {}, catTable = {}, postList = [], taxonomyList = [], visibleTags = [], visibleCats = [];

    // parse tags/categories for full taxonomies list at top of page
    function parseTaxonomies() {
        var taxonomies = document.getElementById("taxonomies");
        var tagElems = taxonomies.getElementsByClassName("tag");
        for(var j = 0; j < tagElems.length; j++) {
            var tagElem = tagElems[j];
            taxonomyList.push(tagElem);
            if (tagElem && tagElem.classList && tagElem.classList.length >= 3) {
                var tagClass = tagElem.classList[2];
                // wrap in a function to circumvent hoisting
                var generateClickFunction = function(tagParam) {
                    return function() {
                        //window.scrollTo(0, 0);
                        toggleTaxonomy(tagParam, null);
                    };
                };
                tagElem.onclick = generateClickFunction(tagClass);
                var tagPosts = tagTable[tagClass] = (tagTable[tagClass] || []);
                tagPosts.push({elem: tagElem});
            }
        }
        var catElems = taxonomies.getElementsByClassName("category");
        for(var j = 0; j < catElems.length; j++) {
            var catElem = catElems[j];
            taxonomyList.push(catElem);
            if (catElem && catElem.classList && catElem.classList.length >= 3) {
                var catClass = catElem.classList[2];
                // wrap in a function to circumvent hoisting
                var generateClickFunction = function(catParam) {
                    return function() {
                        //window.scrollTo(0, 0);
                        toggleTaxonomy(null, catParam);
                    };
                };
                catElem.onclick = generateClickFunction(catClass);
                var catPosts = catTable[catClass] = (catTable[catClass] || []);
                catPosts.push({elem: catElem});
            }
        }
    }

    // parse posts and their taxonomies
    function parsePosts() {
        postList = document.getElementsByClassName("post");
        for(var i = 0; i < postList.length; i++) {
            var post = postList[i];
            var tagElems = post.getElementsByClassName("tag");
            for(var j = 0; j < tagElems.length; j++) {
                var tagElem = tagElems[j];
                taxonomyList.push(tagElem);
                if (tagElem && tagElem.classList && tagElem.classList.length >= 3) {
                    var tagClass = tagElem.classList[2];
                    // wrap in a function to circumvent hoisting
                    var generateClickFunction = function(tagParam) {
                        return function() {
                            //window.scrollTo(0, 0);
                            toggleTaxonomy(tagParam, null);
                        };
                    };
                    tagElem.onclick = generateClickFunction(tagClass);
                    var tagPosts = tagTable[tagClass] = (tagTable[tagClass] || []);
                    tagPosts.push({post: post, elem: tagElem});
                }
            }
            var catElems = post.getElementsByClassName("category");
            for(var j = 0; j < catElems.length; j++) {
                var catElem = catElems[j];
                taxonomyList.push(catElem);
                if (catElem && catElem.classList && catElem.classList.length >= 3) {
                    var catClass = catElem.classList[2];
                    // wrap in a function to circumvent hoisting
                    var generateClickFunction = function(catParam) {
                        return function() {
                            //window.scrollTo(0, 0);
                            toggleTaxonomy(null, catParam);
                        };
                    };
                    catElem.onclick = generateClickFunction(catClass);
                    var catPosts = catTable[catClass] = (catTable[catClass] || []);
                    catPosts.push({post: post, elem: catElem});
                }
            }
        }
    }

    function hideAllPosts() {
        for (var i = 0; i < postList.length; i++) {
            postList[i].classList.add("hidden");
            postList[i].classList.remove("visible");
            postList[i].removeAttribute("style"); // remove any initial styling
        }
        for (var i = 0; i < taxonomyList.length; i++) {
            taxonomyList[i].classList.add("disabled");
        }
    }

    function toggleTaxonomy(tag, category) {
        if (tag) {
            var tagIndex = visibleTags.indexOf(tag);
            if (tagIndex == -1)
                visibleTags.push(tag);
            else
                visibleTags.splice(tagIndex, 1);
        } else if (category) {
            var catIndex = visibleCats.indexOf(category);
            if (catIndex == -1)
                visibleCats.push(category);
            else
                visibleCats.splice(catIndex, 1);
        }
        filterBy(visibleTags, visibleCats);
    }

    function filterBy(tags, categories) {
        hideAllPosts();
        if (tags && tagTable) {
            for ( var i = 0 ; i < tags.length; i++) {
                var tagData = tagTable[tags[i]];
                if (tagData) {
                    for(var j = 0; j < tagData.length; j++) {
                        var data = tagData[j];
                        data.elem.classList.remove("disabled");
                        if (data.post) {
                            data.post.classList.remove("hidden");
                            data.post.classList.add("visible");
                        }
                    }
                }
            }
        }
        if (categories && catTable) {
            for ( var i = 0 ; i < categories.length; i++) {
                var catData = catTable[categories[i]];
                if (catData) {
                    for(var j = 0; j < catData.length; j++) {
                        var data = catData[j];
                        data.elem.classList.remove("disabled");
                        if (data.post) {
                            data.post.classList.remove("hidden");
                            data.post.classList.add("visible");
                        }
                    }
                }
            }
        }
    }
</script>